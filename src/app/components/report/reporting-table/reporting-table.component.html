<div class="table-scroll">
  <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">
    <ng-container class="menu" matColumnDef="icon" [sticky]="true">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element"> 
        <button *ngIf="element.icon" class="mdm-button small-button mat-icon-button {{element.onChart ? 'clicked' : null }}" (click)="updateChart(element)">
          <mat-icon>insights</mat-icon>
        </button>
      </td>
    </ng-container>
  
    <ng-container matColumnDef="name" [sticky]="true">
      <th mat-header-cell *matHeaderCellDef>{{ 'Name' | translate }}</th>
      <td mat-cell *matCellDef="let element" [style]="calcPaddingLevel(element)">
        <div class="menu">
          <div matTooltip="{{element.name}}" [matTooltipShowDelay]="500">{{element.name}}</div>
          <app-reporting-menu [indicator]="element" [dimensionName]="dimensionIds.value" (addIndicatorsEvent)="receiveIndicators($event)" (collapseIndicatorsEvent)="collapseIndicators($event)"></app-reporting-menu>
        </div>
      </td>
    </ng-container>
  
    <ng-container matColumnDef="baseline">
      <th mat-header-cell *matHeaderCellDef >{{ 'Baseline' | translate }}</th>
      <td mat-cell *matCellDef="let element" class="gradient-background">{{ element.baseline }}</td>
    </ng-container>
  
    <ng-container matColumnDef="target">
      <th mat-header-cell *matHeaderCellDef>{{ 'Target' | translate }}</th>
      <td mat-cell *matCellDef="let element" class="gradient-background">{{element.target}}</td>
    </ng-container>
    
    <ng-container matColumnDef="error">
      <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length - 4" class="error">{{element.error === 'Calculation is missing' ? element.error : ('This data is available by ' + (element.error | translate))}}</td>
    </ng-container>

    <ng-container matColumnDef="{{column}}" *ngFor="let column of dimensions">
      <th matTooltip="{{getSiteOrGroupName(column) | translate}}" [matTooltipShowDelay]="500" mat-header-cell *matHeaderCellDef>{{ getSiteOrGroupName(column) | translate }}</th>
      <td mat-cell class="value-cell" *matCellDef="let element" [ngStyle]="{ 'backgroundColor': calcColor(element, column) }">
        <div *ngIf="checkIfNaN(element?.values[column]); else elseNumber">
          <mat-icon class="mat-icon NaN">do_disturb</mat-icon>
        </div>
        <ng-template #elseNumber>
          {{ element.values ? element.values[column] : ''}}
        </ng-template>
      </td>
    </ng-container>

    <!-- Sticky position doesnt work allow a dynamic column span so I had to set a static one-->
    <ng-container matColumnDef="title" [sticky]="true">
      <td mat-cell *matCellDef="let element" [attr.colspan]="2" class="title">
        <div>
        <mat-icon *ngIf="!element.open; else elseOpen">add_circle</mat-icon>
        <ng-template #elseOpen>
          <mat-icon>remove_circle</mat-icon>
        </ng-template>
           {{ element['title'] }}
      </div>
      </td>
    </ng-container>

    <!-- The rest of the row needs to be filled out to keep consistent styling -->
    <ng-container matColumnDef="title_stick" *ngIf="columnsToDisplay.length > 2">
      <td mat-cell *matCellDef="" [attr.colspan]="columnsToDisplay.length - 2"></td>
    </ng-container>
  
    <ng-container matColumnDef="groupName" [sticky]="true">
      <td mat-cell *matCellDef="let element" [attr.colspan]="1" [style]="calcPaddingLevel(element)" class="groupName">{{element.groupName}}</td>
    </ng-container>

    <ng-container matColumnDef="group_stick" *ngIf="columnsToDisplay.length > 2">
      <td mat-cell *matCellDef="" [attr.colspan]="columnsToDisplay.length - 2"></td>
    </ng-container>
  
    <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
    <tr mat-row *matRowDef="let element; columns: COLUMNS_TO_DISPLAY_TITLE; when: isSectionTitle" 
        class="example-element-row"
        (click)="openSection(element)"
    ></tr>
    
    <tr mat-row *matRowDef="let element; columns: columnsToDisplay; when: isInfoRowNoError"></tr>
    <tr mat-row *matRowDef="let element; columns: COLUMNS_TO_DISPLAY_ERROR; when: isInfoRowError"></tr>
    <tr mat-row *matRowDef="let element; columns: COLUMNS_TO_DISPLAY_GROUP; when: isGroupTitle"></tr>
  </table>
</div>
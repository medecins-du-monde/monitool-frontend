<div #reportingTable class="table-scroll {{ isCrossCuttingReport ? 'big-table' : null }}">
  <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">
    <ng-container class="menu" matColumnDef="icon" [sticky]="true">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element">
        <button *ngIf="element.icon" [disabled]="element.error"
          class="mdm-button small-button mat-icon-button {{element.onChart ? 'clicked' : null }} {{element.error ? 'disabled' : null}}"
          (click)="updateChart(element)">
          <mat-icon>insights</mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="name" [sticky]="true">
      <th mat-header-cell *matHeaderCellDef>{{ 'Name' | translate }}</th>
      <td mat-cell *matCellDef="let element" [style]="calcPaddingLevel(element)">
        <div class="menu">
          <div matTooltip="{{element.name}}" [matTooltipShowDelay]="500">{{element.name}}</div>
          <app-reporting-menu [indicator]="element" [dimensionName]="dimensionIds.value"
            (addIndicatorsEvent)="receiveIndicators($event)" (collapseIndicatorsEvent)="collapseIndicators($event)"
            [isCrossCuttingReport]="isCrossCuttingReport"></app-reporting-menu>
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="baseline" [sticky]="true">
      <th mat-header-cell *matHeaderCellDef>{{ 'Baseline' | translate }}</th>
      <td mat-cell *matCellDef="let element" class="gradient-background">{{ getIndicator(element, 'baseline') }}</td>
    </ng-container>

    <ng-container matColumnDef="target" [sticky]="true">
      <th mat-header-cell *matHeaderCellDef>{{ 'Target' | translate }}</th>
      <td mat-cell *matCellDef="let element" class="gradient-background">{{ getIndicator(element, 'target') }}</td>
    </ng-container>

    <ng-container matColumnDef="error">
      <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length - 4" class="error">
        <span *ngFor="let err of element.error">{{ err | translate}} </span>
      </td>
    </ng-container>

    <ng-container matColumnDef="{{column}}" *ngFor="let column of dimensions" [stickyEnd]="column === '_total'">
      <th matTooltip="{{getSiteOrGroupName(column) | translate}}" [matTooltipShowDelay]="500" mat-header-cell
        *matHeaderCellDef>{{ getSiteOrGroupName(column) | translate }}</th>
      <td mat-cell class="value-cell"
        [matTooltip]="isInRange(element, column) ? (getTooltipMessage(element?.values[column]) | translate) : ''"
        *matCellDef="let element"
        [ngStyle]="{
          'backgroundColor': (element.values[column] !== undefined && isInRange(element, column)) ? calcColor(element, column) : 'rgb(238, 238, 238)',
          'fontWeight': column === '_total' ? 'bold' : '',
          'font-style': isItalic(element?.values[column]) ? 'italic' : '' }"
          >
        <!-- <div *ngIf="checkIfNaN(element?.values[column]); else elseNumber">
          <mat-icon class="mat-icon NaN">do_disturb</mat-icon>
        </div>
        <ng-template #elseNumber>
          {{ element.values[column] !== undefined &&  element.values[column] !== null ? (element.values[column].toLocaleString("de-DE") ) : null }}
          {{ (element.unit && element.values[column]) ? element.unit : null }}
        </ng-template> -->

        {{ isInRange(element, column) ? styleValue(element?.values[column], element.unit) : '' }}
      </td>
    </ng-container>

    <!--
    <ng-container matColumnDef="title" [sticky]="true">
      <td mat-cell *matCellDef="let element" [attr.colspan]="20" class="title">
        <div class="title-row">
          <mat-icon *ngIf="!element.open; else elseOpen">add_circle</mat-icon>
          <ng-template #elseOpen>
            <mat-icon>remove_circle</mat-icon>
          </ng-template>
          {{ element['title'] }}
        </div>
      </td>
    </ng-container>
    -->

    <!-- Sticky position doesnt allow a dynamic column span so they have been set as static-->
    <ng-container matColumnDef="title" [sticky]="true">
        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length >= 12 ? 14 : columnsToDisplay.length - 1" class="title">
          <div class="title-row">
            <mat-icon *ngIf="!element.open; else elseOpen">add_circle</mat-icon>
            <ng-template #elseOpen>
              <mat-icon>remove_circle</mat-icon>
            </ng-template>
            <p>
              {{ element['title']}}
            </p>
          </div>
        </td>
    </ng-container>

    <!--The rest of the row needs to be filled out to keep consistent styling -->
    <ng-container matColumnDef="title_stick" *ngIf="columnsToDisplay">
      <td mat-cell *matCellDef="" [attr.colspan]="columnsToDisplay.length >= 9 ? columnsToDisplay.length - 8 : 0"></td>
    </ng-container>

    <ng-container matColumnDef="groupName" [sticky]="true">
      <td mat-cell *matCellDef="let element"
        [attr.colspan]="columnsToDisplay.length >= 15 ? 16 : columnsToDisplay.length + 1"
        class="groupName">
        <p
          [matTooltip]="formatGroupName(element.groupName)"
          [style]="calcPaddingLevel(element)"
          [innerHTML]="formatGroupName(element.groupName)">
        </p>
        </td>
    </ng-container>

    <!--
    <ng-container matColumnDef="groupName" [sticky]="true">
      <td mat-cell *matCellDef="let element" colspan="19" [style]="calcPaddingLevel(element)"
        [ngStyle]="{ 'fontWeight': element.groupName.charAt(0) === 'R' || element.groupName.charAt(0) === 'O' ? 'bold' : ''}"
        class="groupName">{{formatGroupName(element.groupName)}}</td>
    </ng-container>
  -->

    <ng-container matColumnDef="group_stick" *ngIf="columnsToDisplay">
      <td mat-cell *matCellDef="" [attr.colspan]="columnsToDisplay.length - optimalColspanForGroupName - 1"></td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
    <tr mat-row *matRowDef="let element; columns: COLUMNS_TO_DISPLAY_TITLE; when: isSectionTitle"
      class="example-element-row" (click)="toggleSection(element)"></tr>

    <tr mat-row class="blue-hover" *matRowDef="let element; columns: columnsToDisplay; when: isInfoRowNoError"></tr>
    <tr mat-row class="blue-hover" *matRowDef="let element; columns: COLUMNS_TO_DISPLAY_ERROR; when: isInfoRowError"></tr>
    <tr mat-row *matRowDef="let element; columns: COLUMNS_TO_DISPLAY_GROUP; when: isGroupTitle"></tr>
  </table>
</div>

<!--
<button mat-raised-button color="primary" (click)="exportTOExcel()">Export as Excel</button>
-->

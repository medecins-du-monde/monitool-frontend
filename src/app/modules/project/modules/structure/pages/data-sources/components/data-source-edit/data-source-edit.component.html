<div class="mdm-section">
    <div class="mdm-title">{{ 'DataSourceCalendarTitle' | translate }}</div>
    <div [formGroup]="dataSourceForm" class="mdm-form">
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'Name' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <input matInput formControlName="name" placeholder="{{ 'DataSourceEdit.AddNamePlaceholder' | translate }}">
                <mat-hint>
                    <mat-icon>info</mat-icon>{{ 'DataSourceEdit.AddNameHint' | translate }}
                </mat-hint>
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'CollectionSites' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <mat-select formControlName="entities" placeholder="{{ 'DataSourceEdit.CollectionSitesPlaceholder' | translate }}" multiple>
                    <mat-select-trigger>
                        <mat-chip-list>
                            <mat-chip *ngFor="let entity of selectedEntities" [removable]="true"
                                (removed)="onEntityRemoved(entity)" >
                                {{ entity.name }}
                                <mat-icon matChipRemove>cancel</mat-icon>
                            </mat-chip>
                        </mat-chip-list>
                    </mat-select-trigger>

                    <mat-option *ngFor="let entity of entities" [value]="entity">{{ entity.name }}
                    </mat-option>
                </mat-select>
                <mat-hint>
                    <mat-icon>info</mat-icon>{{ 'DataSourceEdit.CollectionSitesHint' | translate }}
                </mat-hint>
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'Periodicity' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <mat-select formControlName="periodicity" placeholder="{{ 'Periodicity' | translate }}">
                    <mat-option *ngFor="let periodicity of periodicities" [value]="periodicity.value">{{ periodicity.display | translate }}
                    </mat-option>
                </mat-select>
                <mat-hint>
                    <mat-icon>info</mat-icon>{{ 'DataSourceEdit.PeriodicityHint' | translate }}
                </mat-hint>
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'StartDate' | translate }}</div>
                <mat-radio-group class="dateGroup">
                    <mat-radio-button (change)="toggleCustomDate($event, 'start')" [checked]="isCustom('start')" value="true" >{{ 'CustomDate' | translate }}</mat-radio-button>
                    <mat-form-field *ngIf="isCustom('start')" appearance="outline" class="mdm-form-field">
                        <input matInput [matDatepicker]="startPicker" formControlName="start">
                        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                        <mat-datepicker #startPicker></mat-datepicker>
                        <mat-hint>
                            <mat-icon>info</mat-icon>{{ 'DataSourceEdit.StartDateHint' | translate }}
                        </mat-hint>
                    </mat-form-field>
                    <mat-radio-button (change)="toggleCustomDate($event, 'start')" [checked]="!isCustom('start')" value="false" >{{ 'SameAsProject' | translate : { date: project.start | localizedDate} }}</mat-radio-button>
                </mat-radio-group>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'EndDate' | translate }}</div>
                <mat-radio-group class="dateGroup">
                    <mat-radio-button (change)="toggleCustomDate($event, 'end')" [checked]="isCustom('end')" value="true" >{{ 'CustomDate' | translate }}</mat-radio-button>
                    <mat-form-field *ngIf="isCustom('end')" appearance="outline" class="mdm-form-field">
                        <input matInput [matDatepicker]="endPicker" formControlName="end">
                        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                        <mat-datepicker #endPicker></mat-datepicker>
                        <mat-hint>
                            <mat-icon>info</mat-icon>{{ 'DataSourceEdit.EndDateHint' | translate }}
                        </mat-hint>
                    </mat-form-field>
                    <mat-radio-button (change)="toggleCustomDate($event, 'end')" [checked]="!isCustom('end')" value="false" >{{ 'SameAsProject' | translate : { date: project.end | localizedDate} }}</mat-radio-button>
                </mat-radio-group>
        </div>
    </div>
</div>
<div class="mdm-section">
    <div class="mdm-title">{{ 'DataSourceStructureTitle' | translate }}</div>
    <div [formGroup]="dataSourceForm">
        <mat-accordion formArrayName="elements" cdkDropList (cdkDropListDropped)="drop($event)">
            <mat-expansion-panel *ngFor="let element of elements.controls; let i=index" [formGroupName]="i" cdkDrag>
                <mat-expansion-panel-header>
                    <mat-panel-title><mat-icon cdkDragHandle>drag_indicator</mat-icon> Variable {{i + 1}}: {{element.value.name}}</mat-panel-title>
                    <mat-panel-description>
                        <button mat-stroked-button class="mdm-button delete-button" (click)="onRemoveElement(i)"><mat-icon>delete</mat-icon>{{ 'RemoveVariable' | translate }}</button>
                    </mat-panel-description>
                </mat-expansion-panel-header>
                <app-form-element-edit [elementForm]="element" [dataSourceName]="dataSourceForm.value.name"></app-form-element-edit>
            </mat-expansion-panel>
        </mat-accordion>
    </div>
</div>
<button mat-stroked-button class="mdm-button" (click)="onAddNewElement()"><mat-icon>add</mat-icon>{{ 'AddVariable' | translate }}</button>

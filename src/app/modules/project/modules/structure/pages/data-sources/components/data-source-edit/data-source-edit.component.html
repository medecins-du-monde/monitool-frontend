<div class="mdm-section">
    <div class="mdm-title">Calendrier</div>
    <div [formGroup]="dataSourceForm" class="mdm-form">
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'Name' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <input matInput formControlName="name" placeholder="{{ 'Name' | translate }}">
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'CollectionSites' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <mat-select formControlName="entities" placeholder="{{ 'CollectionSites' | translate }}" multiple>
                    <mat-select-trigger>
                        <mat-chip-list>
                            <mat-chip *ngFor="let entity of selectedEntities" [removable]="true"
                                (removed)="onEntityRemoved(entity)">
                                {{ entity.name }}
                                <mat-icon matChipRemove>cancel</mat-icon>
                            </mat-chip>
                        </mat-chip-list>
                    </mat-select-trigger>
                    <mat-option *ngFor="let entity of entities" [value]="entity">{{ entity.name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'Periodicity' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <mat-select formControlName="periodicity" placeholder="{{ 'Periodicity' | translate }}">
                    <mat-option *ngFor="let periodicity of periodicities" [value]="periodicity.value">{{ periodicity.display | translate }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'StartDate' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <input matInput [matDatepicker]="startPicker" formControlName="start"
                    placeholder="{{ 'StartDate' | translate }}">
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
            </mat-form-field>
        </div>
        <div class="mdm-form-group">
            <div class="mdm-form-label">{{ 'EndDate' | translate }}</div>
            <mat-form-field appearance="outline" class="mdm-form-field">
                <input matInput [matDatepicker]="endPicker" formControlName="end"
                    placeholder="{{ 'EndDate' | translate }}">
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
            </mat-form-field>
        </div>
    </div>
</div>
<div class="mdm-section">
    <div class="mdm-title">Structure</div>
    <div [formGroup]="dataSourceForm">
        <mat-accordion formArrayName="elements">
            <ng-container *ngFor="let element of elements.controls; let i=index">
                <mat-expansion-panel [formGroupName]="i">
                    <mat-expansion-panel-header>
                        <mat-panel-title>Variable {{i + 1}}: {{element.value.name}}</mat-panel-title>
                        <mat-panel-description>
                            <button mat-stroked-button class="mdm-button" (click)="onRemoveElement(i)"><mat-icon>delete</mat-icon>{{ 'RemoveVariable' | translate }}</button>
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <app-form-element-edit [elementForm]="element" [dataSourceName]="dataSourceForm.value.name"></app-form-element-edit>
                </mat-expansion-panel>
            </ng-container>
        </mat-accordion>
    </div>
</div>
<button mat-stroked-button class="mdm-button" (click)="onAddNewElement()"><mat-icon>add</mat-icon>{{ 'AddVariable' | translate }}</button>
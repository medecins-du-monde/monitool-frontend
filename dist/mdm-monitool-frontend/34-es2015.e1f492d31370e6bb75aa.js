(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{ZIQF:function(t,i,r){"use strict";r.r(i),r.d(i,"CrossCuttingModule",(function(){return C}));var e=r("ofXK"),s=r("sYmb"),o=r("3Pt+"),n=r("0IaG"),c=r("kmnG"),a=r("YjUb"),d=r("tyNb"),m=r("QlGT"),u=r("hPXr"),b=r("IPwQ"),h=r("fXoL"),l=r("RTna"),p=r("c3AT"),f=r("XEzf");function g(t,i){if(1&t){const t=h.Ub();h.Rb(0,11),h.Tb(1,"app-extra-indicator",12),h.ac("edit",(function(){h.sc(t);const r=i.$implicit,e=i.index,s=h.ec().index;return h.ec().onEditIndicator(r,e,s)})),h.Sb(),h.Qb()}if(2&t){const t=i.$implicit;h.Bb(1),h.kc("extraIndicator",t.value)("deletable",!1)}}function v(t,i){if(1&t&&(h.Tb(0,"div",5),h.Tb(1,"div",6),h.Dc(2),h.Sb(),h.Tb(3,"div",7),h.Tb(4,"div",8),h.Tb(5,"div",9),h.Bc(6,g,2,2,"ng-container",10),h.Sb(),h.Sb(),h.Sb(),h.Sb()),2&t){const t=i.$implicit,r=i.index,e=h.ec();h.Bb(2),h.Ec(t.value.theme.name.en),h.Bb(1),h.kc("formGroupName",r),h.Bb(3),h.kc("ngForOf",e.getIndicators(r).controls)}}function T(t,i){if(1&t){const t=h.Ub();h.Rb(0,11),h.Tb(1,"app-extra-indicator",12),h.ac("edit",(function(){h.sc(t);const r=i.$implicit,e=i.index;return h.ec(2).onEditIndicator(r,e)})),h.Sb(),h.Qb()}if(2&t){const t=i.$implicit;h.Bb(1),h.kc("extraIndicator",t.value)("deletable",!1)}}function y(t,i){if(1&t&&(h.Tb(0,"div",13),h.Tb(1,"div",5),h.Tb(2,"div",6),h.Dc(3),h.fc(4,"translate"),h.Sb(),h.Tb(5,"div",14),h.Tb(6,"div",9),h.Bc(7,T,2,2,"ng-container",10),h.Sb(),h.Sb(),h.Sb(),h.Sb()),2&t){const t=h.ec();h.Bb(3),h.Ec(h.gc(4,2,"MultipleThematics")),h.Bb(4),h.kc("ngForOf",t.multiThemesArray.controls)}}const S=[{path:"",component:(()=>{class t{constructor(t,i,r,e,s){this.translateService=t,this.indicatorService=i,this.projectService=r,this.dialog=e,this.fb=s,this.indicators=[],this.groups=[],this.multiThemesIndicators=[]}get groupsArray(){return this.crossCuttingForm.controls.groupsArray}get multiThemesArray(){return this.crossCuttingForm.controls.multiThemesArray}getIndicators(t){return this.crossCuttingForm.controls.groupsArray.get(""+t).get("indicators")}get currentLang(){return this.translateService.currentLang?this.translateService.currentLang:this.translateService.defaultLang}ngOnInit(){this.setForm(),this.projectService.openedProject.subscribe(t=>{this.project=t;const i=[];Object.keys(this.project.crossCutting).map(t=>{const r=this.project.crossCutting[t];r.id=t,i.push(r)}),this.indicatorService.listForProject(Object.keys(t.themes).map(i=>t.themes[i].id)).then(t=>{this.indicators=[],this.groups=[],this.multiThemesIndicators=[],t.map(t=>{const r=i.find(i=>i.id===t.id);r&&(r.themes=t.themes,r.display=t.name.en,r.description=t.description,this.indicators.push(new b.d(r)))}),this.indicators.forEach(t=>{if(t.themes.length>1)this.multiThemesIndicators.push(t);else if(t.themes.length>0){const i=this.groups.find(i=>i.theme.id===t.themes[0].id);i?i.indicators.push(t):t.themes.length>0&&this.groups.push({theme:t.themes[0],indicators:[t]})}}),this.setForm()})})}setForm(){this.crossCuttingForm=this.fb.group({groupsArray:this.fb.array(this.groups.map(t=>u.a.newIndicatorGroup(t))),multiThemesArray:this.fb.array(this.multiThemesIndicators.map(t=>u.a.newIndicator(t,!0)))})}onEditIndicator(t,i,r){this.openDialog(u.a.newIndicator(t.value,!0),i,r)}openDialog(t,i,r){this.dialog.open(m.a,{data:{indicator:t,forms:this.project.forms}}).afterClosed().subscribe(t=>{t&&(r?this.crossCuttingForm.controls.groupsArray.at(r).get("indicators").setControl(i,t.indicator):this.crossCuttingForm.controls.multiThemesArray.setControl(i,t.indicator),this.project.crossCutting[t.indicator.value.id]=new b.d(t.indicator.value),this.projectService.project.next(this.project))})}}return t.\u0275fac=function(i){return new(i||t)(h.Nb(s.d),h.Nb(l.a),h.Nb(p.a),h.Nb(n.b),h.Nb(o.f))},t.\u0275cmp=h.Hb({type:t,selectors:[["app-cross-cutting"]],decls:11,vars:9,consts:[[1,"info-section","blue"],[3,"formGroup"],["formArrayName","groupsArray"],["class","mdm-section",4,"ngFor","ngForOf"],["formArrayName","multiThemesArray",4,"ngIf"],[1,"mdm-section"],[1,"mdm-title"],[3,"formGroupName"],["formArrayName","indicators",1,"indicators-list"],[1,"mdm-cards"],["class","mdm-card",4,"ngFor","ngForOf"],[1,"mdm-card"],[1,"mdm-card",3,"extraIndicator","deletable","edit"],["formArrayName","multiThemesArray"],[1,"indicators-list"]],template:function(t,i){1&t&&(h.Tb(0,"div",0),h.Tb(1,"p"),h.Dc(2),h.fc(3,"translate"),h.Sb(),h.Tb(4,"p"),h.Dc(5),h.fc(6,"translate"),h.Sb(),h.Sb(),h.Tb(7,"div",1),h.Tb(8,"div",2),h.Bc(9,v,7,3,"div",3),h.Sb(),h.Bc(10,y,8,4,"div",4),h.Sb()),2&t&&(h.Bb(2),h.Ec(h.gc(3,5,"CrossCuttingInfo.0")),h.Bb(3),h.Ec(h.gc(6,7,"CrossCuttingInfo.1")),h.Bb(2),h.kc("formGroup",i.crossCuttingForm),h.Bb(2),h.kc("ngForOf",i.groupsArray.controls),h.Bb(1),h.kc("ngIf",i.multiThemesArray.length>0))},directives:[o.s,o.k,o.e,e.k,e.l,o.l,f.a],pipes:[s.c],styles:[".indicator-session[_ngcontent-%COMP%]{display:flex;flex-direction:row}"]}),t})()}];let I=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(i){return new(i||t)},imports:[[d.f.forChild(S)],d.f]}),t})(),C=(()=>{class t{}return t.\u0275mod=h.Lb({type:t}),t.\u0275inj=h.Kb({factory:function(i){return new(i||t)},imports:[[e.c,s.b,I,n.f,o.m,o.w,c.d,a.a]]}),t})()}}]);